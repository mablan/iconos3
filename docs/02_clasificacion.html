<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>iconos: Clasificación de textos (I)</title>
  
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2020-09-09"/>
  <meta property="article:created" itemprop="dateCreated" content="2020-09-09"/>
  <meta name="article:author" content="Magdiel Ablan"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="iconos: Clasificación de textos (I)"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="iconos"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="iconos: Clasificación de textos (I)"/>
  
  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Feature engineering and selection a practical approach for predictive models;citation_publication_date=2020;citation_publisher=Chapman &amp; Hall/CRC;citation_author=Max Kuhn;citation_author=Kjell Johnson"/>
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","subtitle","author","date","output","editor_options","bibliography"]}},"value":[{"type":"character","attributes":{},"value":["Clasificación de textos (I)"]},{"type":"character","attributes":{},"value":["Consumer complaints"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Magdiel Ablan"]}]}]},{"type":"character","attributes":{},"value":["2020-09-09"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["html_document"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["code_download","number_sections","code_folding","theme","toc","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["show"]},{"type":"character","attributes":{},"value":["lumen"]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["collapsed"]}},"value":[{"type":"logical","attributes":{},"value":[true]}]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["chunk_output_type"]}},"value":[{"type":"character","attributes":{},"value":["console"]}]},{"type":"character","attributes":{},"value":["references.bib"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #455a64;
    font-size: 15px;
    font-weight: 300;
  }
  
  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .distill-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .distill-site-nav {
      display: none;
    }
  }
  
  .distill-site-header {
  
  }
  
  .distill-site-footer {
  
  }
  
  
  /* Site Header */
  
  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .distill-site-header .title {
    font-size: 18px;
  }
  
  .distill-site-header .logo {
    padding: 0;
  }
  
  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .distill-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative;}
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  </style>
  
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for table of contents */
  
  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }
  
  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }
  
  .d-toc a {
    border-bottom: none;
  }
  
  .d-toc ul {
    padding-left: 0;
  }
  
  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }
  
  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }
  
  .d-toc li {
    margin-bottom: 0.9em;
  }
  
  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }
  
  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }
  
  
  
  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */
  
  d-code {
    overflow-x: auto !important;
  }
  
  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  pre.text-output {
  
    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  @media(min-width: 768px) {
  
  d-code {
    overflow-x: visible !important;
  }
  
  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Clasificación de textos (I)","authors":[{"author":"Magdiel Ablan","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2020-09-09T00:00:00.000-05:00","citationText":"Ablan, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">iconos</a>
<a href="index.html">Home</a>
<a href="01_intro.html">Exploración</a>
<a href="recursos.html">Recursos</a>
</div>
<div class="nav-right">
<a href="about.html">Créditos</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Clasificación de textos (I)</h1>

</div>

<div class="d-byline">
  
  Magdiel Ablan
  
<br/>2020-09-09
</div>

<div class="d-article">
<h1 id="introducción">Introducción</h1>
<p>Vamos a construir un modelo de clasificación para el conjunto de datos de quejas de consumidores al buró de protección financiera de consumidores de EU. El conjunto se puede descargar del sitio de <a href="https://www.kaggle.com/cfpb/us-consumer-finance-complaints?select=consumer_complaints.csv">Kaggle</a>. La fuente original de los datos es el <a href="https://www.consumerfinance.gov/data-research/consumer-complaints/">CFPB</a></p>
<p>Aquí vamos a seguir de cerca el capítulo 7 del libro de <a href="https://smltar.com/">Hvitfeldt and Silge</a></p>
<p>Leemos los datos y quitamos los registros con NA en la queja:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints &lt;- read_csv(&quot;datos/consumer_complaints.csv&quot;, col_types =  
                cols(consumer_complaint_narrative = col_character(),                        company_public_response = col_character(),
                     consumer_consent_provided = col_character())) %&gt;% 
  drop_na(consumer_complaint_narrative) %&gt;% 
  mutate(date_received = parse_date_time(date_received,&quot;mdY&quot;))
             
glimpse(complaints)</code></pre>
<pre><code>
Rows: 66,806
Columns: 18
$ date_received                &lt;dttm&gt; 2015-03-19, 2015-03-19, 2015-…
$ product                      &lt;chr&gt; &quot;Debt collection&quot;, &quot;Consumer L…
$ sub_product                  &lt;chr&gt; &quot;Other (i.e. phone, health clu…
$ issue                        &lt;chr&gt; &quot;Cont&#39;d attempts collect debt …
$ sub_issue                    &lt;chr&gt; &quot;Debt was paid&quot;, NA, NA, NA, N…
$ consumer_complaint_narrative &lt;chr&gt; &quot;XXXX has claimed I owe them {…
$ company_public_response      &lt;chr&gt; NA, NA, NA, NA, NA, &quot;Company c…
$ company                      &lt;chr&gt; &quot;Diversified Consultants, Inc.…
$ state                        &lt;chr&gt; &quot;NY&quot;, &quot;VA&quot;, &quot;CA&quot;, &quot;CA&quot;, &quot;CA&quot;, …
$ zipcode                      &lt;chr&gt; &quot;121XX&quot;, &quot;221XX&quot;, &quot;946XX&quot;, &quot;90…
$ tags                         &lt;chr&gt; &quot;Older American&quot;, &quot;Servicememb…
$ consumer_consent_provided    &lt;chr&gt; &quot;Consent provided&quot;, &quot;Consent p…
$ submitted_via                &lt;chr&gt; &quot;Web&quot;, &quot;Web&quot;, &quot;Web&quot;, &quot;Web&quot;, &quot;W…
$ date_sent_to_company         &lt;chr&gt; &quot;03/19/2015&quot;, &quot;03/19/2015&quot;, &quot;0…
$ company_response_to_consumer &lt;chr&gt; &quot;Closed with explanation&quot;, &quot;Cl…
$ timely_response              &lt;chr&gt; &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Y…
$ `consumer_disputed?`         &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes…
$ complaint_id                 &lt;dbl&gt; 1290516, 1290492, 1290524, 129…</code></pre>
</div>
Hay 66806 registros y 18 variables. Lo que queremos predecir es el producto al que se refiere la queja:
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints %&gt;% 
  group_by(product) %&gt;% 
  tally() %&gt;% 
  arrange(desc(n))</code></pre>
<pre><code>
# A tibble: 11 x 2
   product                     n
   &lt;chr&gt;                   &lt;int&gt;
 1 Debt collection         17552
 2 Mortgage                14919
 3 Credit reporting        12526
 4 Credit card              7929
 5 Bank account or service  5711
 6 Consumer Loan            3678
 7 Student loan             2128
 8 Prepaid card              861
 9 Payday loan               726
10 Money transfers           666
11 Other financial service   110</code></pre>
</div>
Así luce la narrativa de las primeras quejas:
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
head(complaints$consumer_complaint_narrative,2)</code></pre>
<pre><code>
[1] &quot;XXXX has claimed I owe them {$27.00} for XXXX years despite the PROOF of PAYMENT I sent them : canceled check and their ownPAID INVOICE for {$27.00}! \nThey continue to insist I owe them and collection agencies are after me. \nHow can I stop this harassment for a bill I already paid four years ago? \n&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
[2] &quot;Due to inconsistencies in the amount owed that I was told by M &amp; T Bank and the amount that was reported to the credit reporting agencies, I was advised to write a good will letter in order to address the issue and request the negative entry be removed from my credit report all together. I had a vehicle that was stolen and it was declared a total loss by insurance company. The insurance company and the GAP insurancw companypaid the outstanding balance of the loan, but I was told by M &amp; T Bank that there was still a balance due on the loan. In good faith, without having received any proof as to why there was still a balance, I made a partial payment towards the remaining debt. I then sent the goodwill letter still offering to pay the remainder of the debt, but in exchange for the removal of the negative entry on my credit report. At one point, in XXXX 2015, per my credit monitoring agency, it showed a delinquent balance of {$0.00}, but when I checked my credit report again on XXXX XXXX 2015, there was a delinquent balance of {$1400.00}. The monies from the GAP insurance and my insurance company has been paid, M &amp; T Bank says that I still owe {$620.00}, of which {$210.00} has already been paid. I contacted M &amp; T Bank via return receipt mail, but I have not been given the courtesy of a response yet. \n&quot;</code></pre>
</div>
Quitamos los caracteres de fin de línea:
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
fin_linea &lt;- &quot;\\n&quot;

complaints$consumer_complaint_narrative &lt;- str_replace_all(complaints$consumer_complaint_narrative,fin_linea,&quot;&quot;)

head(complaints$consumer_complaint_narrative,2)</code></pre>
<pre><code>
[1] &quot;XXXX has claimed I owe them {$27.00} for XXXX years despite the PROOF of PAYMENT I sent them : canceled check and their ownPAID INVOICE for {$27.00}! They continue to insist I owe them and collection agencies are after me. How can I stop this harassment for a bill I already paid four years ago? &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
[2] &quot;Due to inconsistencies in the amount owed that I was told by M &amp; T Bank and the amount that was reported to the credit reporting agencies, I was advised to write a good will letter in order to address the issue and request the negative entry be removed from my credit report all together. I had a vehicle that was stolen and it was declared a total loss by insurance company. The insurance company and the GAP insurancw companypaid the outstanding balance of the loan, but I was told by M &amp; T Bank that there was still a balance due on the loan. In good faith, without having received any proof as to why there was still a balance, I made a partial payment towards the remaining debt. I then sent the goodwill letter still offering to pay the remainder of the debt, but in exchange for the removal of the negative entry on my credit report. At one point, in XXXX 2015, per my credit monitoring agency, it showed a delinquent balance of {$0.00}, but when I checked my credit report again on XXXX XXXX 2015, there was a delinquent balance of {$1400.00}. The monies from the GAP insurance and my insurance company has been paid, M &amp; T Bank says that I still owe {$620.00}, of which {$210.00} has already been paid. I contacted M &amp; T Bank via return receipt mail, but I have not been given the courtesy of a response yet. &quot;</code></pre>
</div>
<p>La serie de caracteres “XXX..” que vemos en el texto se usan para proteger la información personal de los consumidores. Hay que verificar siempre que mecanismo es el usado en el conjunto de datos con el que estamos trabajando.</p>
<p>Las cantidades monetarias están rodeadas por {}, como por ejemplo {$75.00}. Esto puede resultar conveniente si en algún momento queremos extraer esta información.</p>
<h1 id="un-primer-modelo-de-clasificación">Un primer modelo de clasificación</h1>
<p>Trataremos de predecir la variable <code>product</code> a las que se refieren las quejas. En una primera instancia, haremos la clasificación de forma binaria, tratando de determinar si una queja se refiere a “Debt collection” o no.</p>
<p>También hay que decidir que variables incluir como predictoras en el modelo. Por lo pronto incluiremos:</p>
<ul>
<li>La fecha (<code>date_received</code>)</li>
<li>El texto de la queja (<code>consumer_complaint_narrative</code>)</li>
<li>La etiqueta (<code>tags</code>)</li>
</ul>
<p>La etiqueta puede ser de tres tipos:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints %&gt;% 
  group_by(tags) %&gt;% 
  tally() %&gt;% 
  arrange(desc(n))</code></pre>
<pre><code>
# A tibble: 4 x 2
  tags                              n
  &lt;chr&gt;                         &lt;int&gt;
1 &lt;NA&gt;                          55389
2 Older American                 6083
3 Servicemember                  4504
4 Older American, Servicemember   830</code></pre>
</div>
<p>Otra variable que podría ser interesante es la forma en la que se introdujo la queja pero en este caso no es útil porque todas son la misma:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints %&gt;% 
  group_by(submitted_via) %&gt;% 
  tally() %&gt;% 
  arrange(desc(n))</code></pre>
<pre><code>
# A tibble: 1 x 2
  submitted_via     n
  &lt;chr&gt;         &lt;int&gt;
1 Web           66806</code></pre>
</div>
<p>Reclasifiquemos <code>product</code> para que tenga solo dos niveles:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints2class &lt;- complaints %&gt;%
  mutate(product = factor(if_else(product == &quot;Debt collection&quot;,
                                  &quot;Debt&quot; ,&quot;Other&quot;))
         )</code></pre>
</div>
<p>Verifiquemos contando de nuevo cuantos registros en cada categoría:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints2class %&gt;%  
  group_by(product) %&gt;% 
  tally()</code></pre>
<pre><code>
# A tibble: 2 x 2
  product     n
  &lt;fct&gt;   &lt;int&gt;
1 Debt    17552
2 Other   49254</code></pre>
</div>
<h2 id="división-entrenamiento-y-prueba">División entrenamiento y prueba</h2>
<p>Ahora, dividimos los datos en un conjunto de entrenamiento y prueba. Por defecto 75% de los datos se usan para entrenamiento y el restante 25% para prueba.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints_split &lt;- initial_split(complaints2class, strata = product)

complaints_train &lt;- training(complaints_split)
complaints_test &lt;- testing(complaints_split)</code></pre>
</div>
<p>Verifiquemos las dimensiones de los conjuntos:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
dim(complaints_train)</code></pre>
<pre><code>
[1] 50105    18</code></pre>
<pre class="r"><code>
dim(complaints_test)</code></pre>
<pre><code>
[1] 16701    18</code></pre>
</div>
<p>Una manera muy usada para evaluar el modelo es dividir el conjunto de entrenamiento en <em>B</em> remuestras, cada una de las cuales esta compuesta de un subconjunto de entrenamiento y un subconjunto de evaluación:</p>
<p><img src="img/02_remuestreo.png" /> (Fuente: <span class="citation" data-cites="kuhn_johnson_2020">Kuhn and Johnson (<a href="#ref-kuhn_johnson_2020" role="doc-biblioref">2020</a>)</span> )</p>
<p>El modelo se ajusta <em>B</em> veces y las medidas de rendimiento del modelo son el promedio de estos ajustes.</p>
<h2 id="preprocesamiento">Preprocesamiento</h2>
<p>Primero se especifica “la receta”, el conjunto de pasos necesarios para preparar nuestros datos para el modelo</p>
<h3 id="la-receta">La receta</h3>
<p>Como los modelos a usar tienen atributos numéricos, tenemos que convertir las características del texto en datos numéricos.</p>
<p>Inicializamos el procesamiento usando:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints_rec &lt;-
  recipe(product ~ date_received + tags + consumer_complaint_narrative,
         data = complaints_train
  )</code></pre>
</div>
<p>Comencemos primero con la variable <code>date_received</code>. El siguiente código:</p>
<ul>
<li><p>Extrae el mes y el día de la semana</p></li>
<li><p>Borra la fecha original</p></li>
<li><p>Convierte el mes y el día de la semana a variables indicadoras</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints_rec &lt;- complaints_rec %&gt;%
  step_date(date_received, features = c(&quot;month&quot;, &quot;dow&quot;), role = &quot;dates&quot;) %&gt;%
  step_rm(date_received) %&gt;%
  step_dummy(has_role(&quot;dates&quot;))</code></pre>
</div>
<p>Seguimos con la variable <code>tags</code>. Aquí:</p>
<ul>
<li><p>Creamos la especificación para datos faltantes</p></li>
<li><p>Convertimos la variable a un tipo indicador</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints_rec &lt;- complaints_rec %&gt;%
  step_unknown(tags) %&gt;%
  step_dummy(tags)</code></pre>
</div>
<p>Finalmente, procesamos la variable que contiene las quejas. En este caso:</p>
<ul>
<li><p>Tokenizamos en palabras</p></li>
<li><p>Removemos las palabras vacías</p></li>
<li><p>Seleccionamos solo las 500 variables más frecuentes</p></li>
<li><p>Calculamos <em>tf-idf</em></p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints_rec &lt;- complaints_rec %&gt;%
  step_tokenize(consumer_complaint_narrative) %&gt;%
  step_stopwords(consumer_complaint_narrative) %&gt;%
  step_tokenfilter(consumer_complaint_narrative, max_tokens = 500) %&gt;%
  step_tfidf(consumer_complaint_narrative)</code></pre>
</div>
<p>Una vez especificados los pasos, estamos listos para aplicar o preparar (<code>prep</code>) la receta</p>
<h3 id="preparar-la-receta">Preparar la receta</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaint_prep &lt;- prep(complaints_rec)</code></pre>
</div>
<p>Otra forma alternativa de trabajar es definir un flujo de trabajo o <code>workflow</code> e incluir los pasos de preprocesamiento, el paso de aplicar el modelo, etc. en en el flujo de trabajo usando <code>workflow</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaint_wf &lt;- workflow() %&gt;%
  add_recipe(complaints_rec)</code></pre>
</div>
<p>El siguiente paso es especificar el modelo</p>
<h2 id="clasificador-bayesiano-ingenuo-naive-bayes-classifier">Clasificador bayesiano ingenuo (<em>Naive Bayes classifier</em>)</h2>
<p>Es un modelo bastante usado en NLP porque permite el uso de muchas variables como las que se tiene cuando se procesa texto. Se basa en calcular la probabilidad de que un elemento se clasifique de cierta manera usando el teorema de Bayes. El adjetivo “ingenuo” se debe a que se presume que las diferentes variables son independientes una de la otra, lo cual no es una suposición muy realista en la mayoría de los casos.</p>
<h3 id="especificación-del-modelo">Especificación del modelo</h3>
<p>Primero especificamos el tipo de modelo y el <em>motor</em> con el cual lo vamos a ejecutar. Lo del motor se refiere a que hay mas de una librería en R que se puede utilizar para la misma tarea y en ese paso especificamos cual es la librería en particular que queremos usar</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
nb_spec &lt;- naive_Bayes() %&gt;%
  set_mode(&quot;classification&quot;) %&gt;%
  set_engine(&quot;naivebayes&quot;)
nb_spec</code></pre>
<pre><code>
Naive Bayes Model Specification (classification)

Computational engine: naivebayes </code></pre>
</div>
<p>En este paso finalmente ajustamos el modelo. Para eso añadimos al flujo de trabajo la especificación del modelo y llamamos a <code>fit</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
nb_fit &lt;- complaint_wf %&gt;%
  add_model(nb_spec) %&gt;%
  fit(data = complaints_train)</code></pre>
</div>
<p>El siguiente paso es ver que tan bueno resulta el modelo comparando el ajuste con el conjunto de prueba. Sin embargo, es mejor hacer el ajuste usando una validación cruzada de diez pliegos, como discutimos antes.</p>
<h3 id="evaluación">Evaluación</h3>
<p>Definimos los pliegos. Por defecto son 10, cada uno con el 90% de datos como entrenamiento y el 10% restante de evaluación</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
complaints_folds &lt;- vfold_cv(complaints_train)

complaints_folds</code></pre>
<pre><code>
#  10-fold cross-validation 
# A tibble: 10 x 2
   splits             id    
   &lt;list&gt;             &lt;chr&gt; 
 1 &lt;split [45.1K/5K]&gt; Fold01
 2 &lt;split [45.1K/5K]&gt; Fold02
 3 &lt;split [45.1K/5K]&gt; Fold03
 4 &lt;split [45.1K/5K]&gt; Fold04
 5 &lt;split [45.1K/5K]&gt; Fold05
 6 &lt;split [45.1K/5K]&gt; Fold06
 7 &lt;split [45.1K/5K]&gt; Fold07
 8 &lt;split [45.1K/5K]&gt; Fold08
 9 &lt;split [45.1K/5K]&gt; Fold09
10 &lt;split [45.1K/5K]&gt; Fold10</code></pre>
</div>
<p>Actualizamos nuestro flujo de trabajo para incluir el modelo:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
nb_wf &lt;- workflow() %&gt;%
  add_recipe(complaints_rec) %&gt;%
  add_model(nb_spec)

nb_wf</code></pre>
<pre><code>
══ Workflow ═══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: naive_Bayes()

── Preprocessor ───────────────────────────────────────────────────────
9 Recipe Steps

● step_date()
● step_rm()
● step_dummy()
● step_unknown()
● step_dummy()
● step_tokenize()
● step_stopwords()
● step_tokenfilter()
● step_tfidf()

── Model ──────────────────────────────────────────────────────────────
Naive Bayes Model Specification (classification)

Computational engine: naivebayes </code></pre>
</div>
<p>y ajustamos de nuevo el modelo esta vez usando validación cruzada</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
nb_rs &lt;- fit_resamples(
  nb_wf,
  complaints_folds,
  control = control_resamples(save_pred = TRUE)
)</code></pre>
</div>
<p>Ahora si recogemos las métricas que evaluan el modelo en todos los pliegos y sus respectivas predicciones:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
nb_rs_metrics &lt;- collect_metrics(nb_rs)
nb_rs_predictions &lt;- collect_predictions(nb_rs)</code></pre>
</div>
<p>Las métricas principales son la precisión (<code>accuracy</code>) y el área bajo la curva ROC. Ambas métricas, mientras más cercanas a uno mejor.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
nb_rs_metrics</code></pre>
<pre><code>
# A tibble: 2 x 5
  .metric  .estimator  mean     n std_err
  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 accuracy binary     0.740    10 0.00128
2 roc_auc  binary     0.894    10 0.00162</code></pre>
</div>
<p>Podemos dibujar la <a href="https://es.wikipedia.org/wiki/Curva_ROC">curva ROC</a> para el modelo:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
nb_rs_predictions %&gt;%
  group_by(id) %&gt;%
  roc_curve(truth = product, .pred_Debt) %&gt;%
  autoplot() +
  labs(
    color = NULL,
    title = &quot;Receiver operator curve for US Consumer Finance Complaints&quot;,
    subtitle = &quot;Each resample fold is shown in a different color&quot;
  )</code></pre>
<p><img src="02_clasificacion_files/figure-html5/curvaroc-1.png" width="624" /></p>
</div>
<p>También podemos visualizar la <a href="https://en.wikipedia.org/wiki/Confusion_matrix">matriz de confusión</a>, en este caso, para el primer pliego</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
nb_rs_predictions %&gt;%
  filter(id == &quot;Fold01&quot;) %&gt;%
  conf_mat(product, .pred_class) %&gt;%
  autoplot(type = &quot;heatmap&quot;)</code></pre>
<p><img src="02_clasificacion_files/figure-html5/confusion1-1.png" width="624" /></p>
</div>
<p>Veamos si es posible mejorar estos resultados con un modelo diferente</p>
<h2 id="modelo-de-máquinas-de-soporte-vectorial-svm">Modelo de máquinas de soporte vectorial (SVM)</h2>
<p>Los modelos de máquinas de soporte vectorial son un tipo de modelo de aprendizaje automático que puede usarse en tareas de clasificación y regresión y que ha sido usado con éxito en tareas de clasificación de texto.</p>
<p>Comparemos el modelo anterior con este modelo a ver cual de los dos tiene mejor <em>performace</em>.</p>
<p>Igual que antes, especificamos el tipo de modelo y el motor de aprendizaje:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
svm_spec &lt;- svm_rbf() %&gt;%
  set_mode(&quot;classification&quot;) %&gt;%
  set_engine(&quot;liquidSVM&quot;)</code></pre>
</div>
<p>y definimos un nuevo flujo de trabajo con el mismo preprocesamiento y esta nueva especificación de modelo:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
svm_wf &lt;- workflow() %&gt;%
  add_recipe(complaints_rec) %&gt;%
  add_model(svm_spec)</code></pre>
</div>
<p>Ahora ajustamos el modelo. Como SVM no produce probabilidades como el modelo anterior, especificamos metricas un poco diferentes:</p>
<ul>
<li><code>sensitivity</code>: sensibilidad o tasa de verdaderos positivos</li>
<li><code>specificity</code>: especificidad o tasa de verdaderos negativos</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
svm_rs &lt;- fit_resamples(
  svm_wf,
  complaints_folds,
  metrics = metric_set(accuracy, sensitivity, specificity),
  control = control_resamples(save_pred = TRUE)
)</code></pre>
</div>
<p>Recopilamos las metricas del ajuste anterior:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
svm_rs_metrics &lt;- collect_metrics(svm_rs)
svm_rs_predictions &lt;- collect_predictions(svm_rs)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
svm_rs_metrics</code></pre>
<pre><code>
# A tibble: 3 x 5
  .metric  .estimator  mean     n std_err
  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 accuracy binary     0.842    10 0.00289
2 sens     binary     0.652    10 0.00668
3 spec     binary     0.910    10 0.00172</code></pre>
</div>
<p>La precisión mejoró. Veamos ahora la matriz de confusión:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
svm_rs_predictions %&gt;%
  filter(id == &quot;Fold01&quot;) %&gt;%
  conf_mat(product, .pred_class) %&gt;%
  autoplot(type = &quot;heatmap&quot;)</code></pre>
<p><img src="02_clasificacion_files/figure-html5/unnamed-chunk-19-1.png" width="624" /></p>
</div>
<p>Mejoró también la separación entre las clases.</p>
<p>Ahora, pongamosle las cosas un poco más complicadas al modelo haciendo una clasificación múltiple</p>
<h1 id="clasificación-multiple">Clasificación multiple</h1>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
set.seed(1234)

multicomplaints_split &lt;- initial_split(complaints, strata = product)

multicomplaints_train &lt;- training(multicomplaints_split)
multicomplaints_test &lt;- testing(multicomplaints_split)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multicomplaints_rec &lt;-
  recipe(product ~ date_received + tags + consumer_complaint_narrative,
    data = multicomplaints_train
  ) %&gt;%
  step_date(date_received, features = c(&quot;month&quot;, &quot;dow&quot;), role = &quot;dates&quot;) %&gt;%
  step_rm(date_received) %&gt;%
  step_dummy(has_role(&quot;dates&quot;)) %&gt;%
  step_unknown(tags) %&gt;%
  step_dummy(tags) %&gt;%
  step_tokenize(consumer_complaint_narrative) %&gt;%
  step_stopwords(consumer_complaint_narrative) %&gt;%
  step_tokenfilter(consumer_complaint_narrative, max_tokens = 500) %&gt;%
  step_tfidf(consumer_complaint_narrative) %&gt;%
  step_downsample(product)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multicomplaints_folds &lt;- vfold_cv(multicomplaints_train)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multi_svm_wf &lt;- workflow() %&gt;%
  add_recipe(multicomplaints_rec) %&gt;%
  add_model(svm_spec)

multi_svm_wf</code></pre>
<pre><code>
══ Workflow ═══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: svm_rbf()

── Preprocessor ───────────────────────────────────────────────────────
10 Recipe Steps

● step_date()
● step_rm()
● step_dummy()
● step_unknown()
● step_dummy()
● step_tokenize()
● step_stopwords()
● step_tokenfilter()
● step_tfidf()
● step_downsample()

── Model ──────────────────────────────────────────────────────────────
Radial Basis Function Support Vector Machine Specification (classification)

Computational engine: liquidSVM </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multi_svm_rs &lt;- fit_resamples(
  multi_svm_wf,
  multicomplaints_folds,
  metrics = metric_set(accuracy),
  control = control_resamples(save_pred = TRUE)
)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multi_svm_rs</code></pre>
<pre><code>
# Resampling results
# 10-fold cross-validation 
# A tibble: 10 x 5
   splits         id     .metrics       .notes       .predictions     
   &lt;list&gt;         &lt;chr&gt;  &lt;list&gt;         &lt;list&gt;       &lt;list&gt;           
 1 &lt;split [45.1K… Fold01 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,011 ×…
 2 &lt;split [45.1K… Fold02 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,011 ×…
 3 &lt;split [45.1K… Fold03 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,011 ×…
 4 &lt;split [45.1K… Fold04 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,011 ×…
 5 &lt;split [45.1K… Fold05 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,011 ×…
 6 &lt;split [45.1K… Fold06 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,011 ×…
 7 &lt;split [45.1K… Fold07 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,010 ×…
 8 &lt;split [45.1K… Fold08 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,010 ×…
 9 &lt;split [45.1K… Fold09 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,010 ×…
10 &lt;split [45.1K… Fold10 &lt;tibble [1 × … &lt;tibble [0 … &lt;tibble [5,010 ×…</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multi_svm_rs_metrics &lt;- collect_metrics(multi_svm_rs)
multi_svm_rs_predictions &lt;- collect_predictions(multi_svm_rs)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multi_svm_rs_metrics</code></pre>
<pre><code>
# A tibble: 1 x 5
  .metric  .estimator  mean     n std_err
  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 accuracy multiclass 0.489    10 0.00564</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multi_svm_rs_predictions %&gt;%
  filter(id == &quot;Fold01&quot;) %&gt;%
  conf_mat(product, .pred_class) %&gt;%
  autoplot(type = &quot;heatmap&quot;) +
  scale_y_discrete(labels = function(x) str_wrap(x, 20)) +
  scale_x_discrete(labels = function(x) str_wrap(x, 20))</code></pre>
<p><img src="02_clasificacion_files/figure-html5/unnamed-chunk-28-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
multi_svm_rs_predictions %&gt;%
  filter(id == &quot;Fold01&quot;) %&gt;%
  filter(.pred_class != product) %&gt;%
  conf_mat(product, .pred_class) %&gt;%
  autoplot(type = &quot;heatmap&quot;) +
  scale_y_discrete(labels = function(x) str_wrap(x, 20)) +
  scale_x_discrete(labels = function(x) str_wrap(x, 20))</code></pre>
<p><img src="02_clasificacion_files/figure-html5/unnamed-chunk-29-1.png" width="624" /></p>
</div>
<h1 id="los-mecanismos-de-anonimización">Los mecanismos de anonimización</h1>
<h1 id="referencias" class="unnumbered">Referencias</h1>
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-kuhn_johnson_2020">
<p>Kuhn, Max, and Kjell Johnson. 2020. <em>Feature Engineering and Selection a Practical Approach for Predictive Models</em>. Chapman &amp; Hall/CRC.</p>
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<script id="distill-bibliography" type="text/bibtex">
@article{grms11,
author = {Gabadinho, A. and G. Ritschard and N. S. Muller and M. Studer},
journal = {Journal of Statistical Software},
number = {4},
pages = {1-37},
title = {Analyzing and Visualizing State Sequences in R with TraMineR},
volume = {40},
year = {2011},
doi = {10.18637/jss.v040.i04},
}
@book{kuhn_johnson_2020, 
place={Boca Raton}, 
title={Feature engineering and selection a practical approach for predictive models}, 
publisher={Chapman & Hall/CRC}, 
author={Kuhn, Max and Johnson, Kjell}, 
year={2020}
}
</script>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
